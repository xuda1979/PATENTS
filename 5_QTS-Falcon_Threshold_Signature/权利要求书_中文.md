# 权利要求书

## 独立权利要求

### 权利要求 1 (系统权利要求)

一种基于格密码 Falcon 算法的量子安全门限签名系统，包括通过网络连接的多个硬件节点，每个节点包括处理器和存储加密指令及密钥分片的存储器，所述系统包括：

a) 可验证分布式密钥生成模块，配置用于利用安全多方计算在 $n$ 个节点之间生成满足 $fG - gF = q$ 的 NTRU 陷门秘密共享分片，其中：
   - 每个节点 $P_i$ 在其本地存储器中持有陷门分片 $([f]_i, [g]_i, [F]_i, [G]_i)$，使得 $\sum_{i=1}^{n}[f]_i = f$，且 $g, F, G$ 同理；
   - 任何少于门限数量 $t$ 的节点联盟除了公钥 $h = g \cdot f^{-1} \mod q$ 之外，无法获得关于完整私钥的任何信息；
   - 通过加密承诺和零知识证明确保分片生成的正确性，从而实现可验证性；

b) 算术共享变换域计算模块，配置用于以分布式方式执行 Falcon 签名生成所需的多项式运算，其中：
   - 每个节点处理器在本地对其私钥分片 $[f]_i$ 计算数论变换（NTT）；
   - 利用 NTT 的线性性质，使得 $\text{NTT}(\sum_{i=1}^{n} [f]_i) = \sum_{i=1}^{n} \text{NTT}([f]_i)$；
   - 变换域多项式乘法通过分片上的逐点运算执行：$[\text{NTT}(f \cdot g)]_i = \text{NTT}([f]_i) \odot \text{NTT}(g)$；
   - 在任何计算阶段都不需要重构私钥多项式；

c) 具有方差保持聚合功能的分布式高斯采样模块，配置用于生成分布正确的样本，其中：
   - 每个节点 $P_i$ 从缩放的离散高斯分布 $[z]_i \leftarrow D_{\sigma/\sqrt{n}, R}$ 中采样，其中 $\sigma$ 是目标 Falcon 参数；
   - 根据高斯卷积定理，聚合值 $z = \sum_{i=1}^{n}[z]_i$ 服从目标分布 $D_{\sigma, R}$；
   - 个体样本的统计独立性确保了每个节点贡献的隐私性；

d) 协同拒绝采样模块，配置用于执行具有隐私保护的分布式接受测试，包括：
   - 本地掩码生成子模块，用于在每个节点生成随机掩码 $m_i$；
   - 承诺子模块，用于通过网络接口计算并广播本地签名分片的加密承诺 $C_i = H(m_i \| [s]_i)$；
   - 安全范数计算子模块，利用 Beaver 三元组预处理在常数轮次内计算全局签名范数 $\|s\|^2 = \sum_{i}\|[s]_i\|^2 + 2\sum_{i<j}\langle[s]_i, [s]_j\rangle$；
   - 分布式抛币子模块，用于以正比于 $\exp(-\|s\|^2/(2\sigma^2))$ 的概率进行协同接受决策；
   - 其中在线通信复杂度从 $O(n)$ 轮降低到确切的 6 轮常数轮次；

e) 签名聚合与验证模块，配置用于聚合来自参与节点的签名分量，并输出标准 Falcon 格式的数字签名 $\sigma = (r, \text{Compress}(s_2))$，该签名可使用未经修改的标准 Falcon 验证算法进行验证。

### 权利要求 2 (方法权利要求)

一种基于格密码 Falcon 算法的量子安全门限签名方法，由分布在网络中的多个处理器执行，包括以下步骤：

S1) 可验证分布式密钥生成：$n$ 个签名节点通过安全多方计算协议协同生成 NTRU 陷门，包括：
   - 每个节点 $P_i$ 从缩放的离散高斯分布中采样本地多项式分片 $[f]_i, [g]_i \leftarrow D_{\sigma/\sqrt{n}, R}$；
   - 计算承诺 $C_i = \text{Commit}([f]_i, r_i)$ 并生成正确采样的零知识证明；
   - 跨节点验证所有承诺和证明；
   - 执行 MPC 扩展欧几里得（MPC-Extended-GCD）协议，在秘密共享多项式上求解 $fG - gF = q$；
   - 将陷门分片 $([f]_i, [g]_i, [F]_i, [G]_i)$ 分发给每个节点，并发布公共公钥 $h = g \cdot f^{-1} \mod q$；

S2) 离线预处理：使用后量子安全的不经意传输扩展生成满足 $\sum_i [c]_i = (\sum_i [a]_i) \cdot (\sum_i [b]_i)$ 的 Beaver 乘法三元组 $\{([a]_i, [b]_i, [c]_i)\}$，并通过牺牲协议验证，确保正确性概率为 $1 - 2^{-40}$；

S3) 消息预处理：接收待签名的消息 $M$，通过承诺-揭示机制采样分布式随机盐值 $r$，使用 SHAKE-256 计算加密哈希 $c = H(r \| M)$，并将哈希值映射到 $R_q$ 中的目标多项式；

S4) 本地签名分片计算：每个节点 $P_i$ 执行：
   - 计算本地陷门贡献 $[t]_i = (\text{NTT}^{-1}(\text{NTT}([F]_i) \odot \text{NTT}(c)), \text{NTT}^{-1}(\text{NTT}([G]_i) \odot \text{NTT}(c)))$；
   - 采样具有缩放参数的本地高斯噪声 $[z]_i \leftarrow D_{\sigma/\sqrt{n}, R}^2$；
   - 计算掩码签名分片 $[s]_i = [t]_i + [z]_i$；
   - 使用随机掩码 $m_i$ 生成承诺 $C_i = H(m_i \| [s]_i)$；

S5) 具有常数轮次安全聚合的协同拒绝采样，包括：
   - 第 1 轮：广播承诺 $\{C_i\}$ 以将各方绑定到分片；
   - 第 2-3 轮：使用 Beaver 乘法协议计算所有 $i < j$ 的交叉项内积 $\langle[s]_i, [s]_j\rangle$；
   - 第 4 轮：聚合并不经意揭示全局范数 $\|s\|^2$；
   - 第 5 轮：执行分布式抛币，以概率 $p = M^{-1} \cdot \exp(-\langle s, c \rangle / \sigma^2)$ 确定接受；
   - 如果被拒绝，返回步骤 S4 进行重采样；

S6) 签名聚合：在接受后：
   - 第 6 轮：每个节点揭示签名分片 $[s]_i$；
   - 针对承诺验证揭示的分片；
   - 聚合分量 $(s_1, s_2) = \sum_{i=1}^{n}[s]_i$；
   - 根据 Falcon 压缩算法压缩签名分量 $s_2$；
   - 输出标准 Falcon 格式的最终签名 $\sigma = (r, \text{Compress}(s_2))$。

### 权利要求 3 (独立方法权利要求 - 分布式密钥生成)

一种用于量子安全门限签名系统的 NTRU 陷门可验证分布式生成方法，由 $n$ 个计算节点执行，包括：

a) **分布式多项式采样**：每个节点 $P_i$ 独立地从缩放的离散高斯分布 $D_{\sigma/\sqrt{n}, R}$ 中采样本地多项式分片 $[f]_i, [g]_i$，使得分片之和 $f = \sum [f]_i$ 和 $g = \sum [g]_i$ 服从目标分布 $D_{\sigma, R}$；

b) **可验证承诺**：每个节点广播其本地分片的加密承诺，并提供格式良好的零知识证明，以确保没有节点采样熵不足的分布；

c) **安全逆计算**：节点利用安全多方计算（MPC）协议协同计算环 $R_q$ 中多项式 $f$ 的共享逆，以生成公钥 $h = g \cdot f^{-1} \mod q$；

d) **分布式陷门补全**：节点执行基于 MPC 的扩展欧几里得算法（XGCD），协同查找满足 NTRU 方程的秘密共享多项式 $[F]_i$ 和 $[G]_i$：
   $$f \cdot \left(\sum [G]_i\right) - g \cdot \left(\sum [F]_i\right) = q$$
   且没有任何节点获知完整多项式 $f, g, F, \text{或 } G$；

e) **分片输出**：每个节点将结果陷门分片元组 $([f]_i, [g]_i, [F]_i, [G]_i)$ 存储在安全存储器中，以支持后续的门限签名操作。

---

## 从属权利要求

### 依赖于权利要求 1 (系统) 的权利要求

**权利要求 4.** 根据权利要求 1 所述的系统，其中所述算术共享变换域计算模块利用中国剩余定理同构 $R_q \cong \mathbb{Z}_q^n$ 执行多项式乘法：
$$\text{NTT}(f \cdot g) = \text{NTT}(f) \odot \text{NTT}(g)$$
从而实现变换操作本身的零节点间通信的每系数并行计算。

**权利要求 5.** 根据权利要求 1 所述的系统，其中所述分布式高斯采样模块实现方差保持聚合，满足：
$$\text{Var}(\sum [z]_i) = \sum \text{Var}([z]_i) = n \cdot (\sigma/\sqrt{n})^2 = \sigma^2$$
确保聚合噪声分布与标准 Falcon 签名算法完全不可区分。
